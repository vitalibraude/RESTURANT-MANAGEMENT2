import*as o from"xlsx";import{s as a}from"./index-BaGq2raW.js";async function _(u){const t=[];try{const p=await u.arrayBuffer(),n=o.read(p,{type:"array"}),c=n.Sheets[n.SheetNames[0]],l=o.utils.sheet_to_json(c,{header:1}).slice(1).map(e=>{var r,s,i;return{supplier_name:((r=e[0])==null?void 0:r.toString().trim())||"",product_name:((s=e[1])==null?void 0:s.toString().trim())||"",unit:((i=e[2])==null?void 0:i.toString().trim())||"",price:parseFloat(e[3])||0}}).filter(e=>e.supplier_name&&e.product_name&&e.unit&&e.price);for(const e of l){let r=null;const{data:s}=await a.from("suppliers").select("id").eq("name",e.supplier_name).single();if(s)r=s.id;else{const{data:m,error:d}=await a.from("suppliers").insert([{name:e.supplier_name}]).select().single();if(d){t.push(`שגיאה ביצירת ספק: ${e.supplier_name}`);continue}r=m.id}const{error:i}=await a.from("supplier_products").insert([{supplier_id:r,name:e.product_name,unit:e.unit,price:e.price}]);i&&t.push(`שגיאה ביצירת מוצר: ${e.product_name} אצל ${e.supplier_name}`)}return{success:t.length===0,errors:t}}catch(p){return{success:!1,errors:[p.message||"שגיאה בקריאת קובץ Excel"]}}}export{_ as importSuppliersFromExcel};
